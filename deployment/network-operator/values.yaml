# Copyright 2020 NVIDIA
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Default values for network-operator.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

nfd:
  enabled: true

psp:
  enabled: false

sriovNetworkOperator:
  enabled: false

# Node Feature discovery chart related values
node-feature-discovery:
  image:
    pullPolicy: IfNotPresent
  master:
    instance: "nvidia.networking"
  worker:
    tolerations:
      - key: "node-role.kubernetes.io/master"
        operator: "Equal"
        value: ""
        effect: "NoSchedule"
      - key: "nvidia.com/gpu"
        operator: "Equal"
        value: "present"
        effect: "NoSchedule"
    config: |
      sources:
          pci:
            deviceClassWhitelist:
              - "02"
              - "0200"
              - "0207"
            deviceLabelFields:
              - vendor


# SR-IOV Network Operator chart related values
sriov-network-operator:
  operator:
    tolerations:
      - key: "node-role.kubernetes.io/master"
        operator: "Exists"
        effect: "NoSchedule"
    nodeSelector:
      node-role.kubernetes.io/master: ""
    nameOverride: ""
    fullnameOverride: ""
    resourcePrefix: "nvidia.com"
    enableAdmissionController: false
    cniBinPath: "/opt/cni/bin"
    clusterType: "kubernetes"

  # Image URIs for sriov-network-operator components
  images:
    operator: ghcr.io/k8snetworkplumbingwg/sriov-network-operator:15db3605baac1408e88db89fac35b35a0543a5b4
    sriovConfigDaemon: ghcr.io/k8snetworkplumbingwg/sriov-network-operator-config-daemon:15db3605baac1408e88db89fac35b35a0543a5b4
    sriovCni: ghcr.io/k8snetworkplumbingwg/sriov-cni:v2.6.2
    ibSriovCni: ghcr.io/k8snetworkplumbingwg/ib-sriov-cni:v1.0.2
    sriovDevicePlugin: ghcr.io/k8snetworkplumbingwg/sriov-network-device-plugin:a765300344368efbf43f71016e9641c58ec1241b
    resourcesInjector: ghcr.io/k8snetworkplumbingwg/network-resources-injector:4f0659bb26d08688127d5d51ce9bb075182f1dc2
    webhook: ghcr.io/k8snetworkplumbingwg/sriov-network-operator-webhook:v1.1.0

# General Operator related values
# The operator element allows to deploy network operator from an alternate location
operator:
  tolerations:
    - key: "node-role.kubernetes.io/master"
      operator: "Equal"
      value: ""
      effect: "NoSchedule"
  nodeSelector: {}
  affinity:
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          preference:
            matchExpressions:
              - key: "node-role.kubernetes.io/master"
                operator: In
                values: [""]
  repository: nvcr.io/nvidia/cloud-native
  image: network-operator
  imagePullSecrets: []
  nameOverride: ""
  fullnameOverride: ""
  # tag, if defined will use the given image tag, else Chart.AppVersion will be used
  # tag

proxy:
  httpProxy: ""
  httpsProxy: ""
  noProxy: ""

# NicClusterPolicy CR values:
deployCR: false
ofedDriver:
  deploy: false
  image: mofed
  repository: mellanox
  version: 5.5-1.0.3.2
  imagePullSecrets: []
  startupProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 30
  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 30

nvPeerDriver:
  deploy: false
  image: nv-peer-mem-driver
  repository: mellanox
  version: 1.1-0
  imagePullSecrets: []
  gpuDriverSourcePath: /run/nvidia/driver

rdmaSharedDevicePlugin:
  deploy: true
  image: k8s-rdma-shared-dev-plugin
  repository: nvcr.io/nvidia/cloud-native
  version: v1.2.1
  imagePullSecrets: []
  # The following defines the RDMA resources in the cluster
  # it must be provided by the user when deploying the chart
  # each entry in the resources element will create a resource with the provided <name> and list of devices
  # example:
  resources:
    - name: rdma_shared_device_a
      vendors: [15b3]

sriovDevicePlugin:
  deploy: true
  image: sriov-network-device-plugin
  repository: ghcr.io/k8snetworkplumbingwg
  version: a765300344368efbf43f71016e9641c58ec1241b
  imagePullSecrets: []
  resources:
    - name: hostdev
      vendors: [15b3]

secondaryNetwork:
  deploy: true
  cniPlugins:
    deploy: true
    image: plugins
    repository: ghcr.io/k8snetworkplumbingwg
    version: v0.8.7-amd64
    imagePullSecrets: []
  multus:
    deploy: true
    image: multus-cni
    repository: ghcr.io/k8snetworkplumbingwg
    version: v3.8
    imagePullSecrets: []
    config: ''
  ipamPlugin:
    deploy: true
    image: whereabouts
    repository: ghcr.io/k8snetworkplumbingwg
    version: v0.5.1-amd64
    imagePullSecrets: []

test:
  pf: ens2f0
